#!/bin/bash

set -euxo pipefail

cd "$(dirname "$0")/.."

echo ["$(date "+%H:%M:%S")"] "==> Started atâ€¦"

time ruby ./bin/pypi.rb

if git status | grep 'nothing to commit'; then
  echo 'Nothing to commit'
else
  git add -A .index
  git commit -m 'Update PyPI index'
  git fetch origin
  git rebase origin/master
  git push origin master
fi
